<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>File Uploader</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 10px;
      }
      #fileInput {
        margin-bottom: 10px;
      }
      #status {
        color: red;
      }
    </style>
  </head>
  <body>
    <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.gif,.pdf" />
    <div id="status"></div>

    <script>
      const fileInput = document.getElementById("fileInput");
      const statusDiv = document.getElementById("status");

      fileInput.addEventListener("change", () => {
        const file = fileInput.files[0];
        if (!file) {
          statusDiv.textContent = "Файл не выбран.";
          return;
        }

        const allowedTypes = [
          "image/png",
          "image/jpeg",
          "image/gif",
          "application/pdf",
        ];
        const maxSize = 5 * 1024 * 1024; // 5MB

        if (!allowedTypes.includes(file.type)) {
          statusDiv.textContent =
            "Недопустимый тип файла. Разрешены только PNG, JPEG, GIF и PDF.";
          fileInput.value = ""; // Очистить выбор файла
          return;
        }

        if (file.size > maxSize) {
          statusDiv.textContent =
            "Файл слишком большой. Максимальный размер: 5MB.";
          fileInput.value = ""; // Очистить выбор файла
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          const base64Data = e.target.result.split(",")[1];
          // Отправляем сообщение родительскому окну
          parent.postMessage(
            {
              type: "fileUpload",
              data: {
                fileBase64: base64Data,
                fileName: file.name,
                fileType: file.type,
              },
            },
            "*"
          );
          statusDiv.style.color = "green";
          statusDiv.textContent = "Файл успешно выбран.";
        };
        reader.onerror = function () {
          statusDiv.textContent = "Ошибка при чтении файла.";
        };
        reader.readAsDataURL(file);
      });
    </script>
  </body>
</html>
